services:
  jekyll:
    image: jekyll/builder:latest
    working_dir: /srv/jekyll
    user: root
    environment:
      - BUNDLE_GEMFILE=/srv/jekyll/Gemfile
      - JEKYLL_ENV=production
      - SASS_CACHE_DIR=/srv/jekyll/.sass-cache
    volumes:
      - ./Gemfile:/srv/jekyll/Gemfile:ro
      - ./Gemfile.lock:/srv/jekyll/Gemfile.lock:ro
      - ./_config.yml:/srv/jekyll/_config.yml:ro
      - ../README.md:/srv/jekyll/README.md:ro
      - ../labs:/srv/jekyll/labs:ro
    tmpfs:
      - /srv/jekyll/_site
      - /srv/jekyll/.sass-cache
      - /srv/jekyll/.jekyll-cache
    ports:
      - "4000:4000"
      - "35729:35729"
    command: >-
      bash -lc "chown -R jekyll:jekyll /srv/jekyll/_site /srv/jekyll/.sass-cache /srv/jekyll/.jekyll-cache &&
      bundle install &&
      bundle exec jekyll serve --host=0.0.0.0 --watch --livereload
      --source /srv/jekyll --destination /srv/jekyll/_site
      --config /srv/jekyll/_config.yml"

volumes: {}
